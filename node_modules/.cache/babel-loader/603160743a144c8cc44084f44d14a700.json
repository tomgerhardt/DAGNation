{"ast":null,"code":"import _slicedToArray from \"/Users/tomgerhardt/Dropbox/TOM/Web3 Consulting/Node Nation/DAG Nation/shuffle 042622/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _asyncToGenerator from \"/Users/tomgerhardt/Dropbox/TOM/Web3 Consulting/Node Nation/DAG Nation/shuffle 042622/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _regeneratorRuntime from \"/Users/tomgerhardt/Dropbox/TOM/Web3 Consulting/Node Nation/DAG Nation/shuffle 042622/node_modules/@babel/runtime/regenerator/index.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useCallback, useEffect, useReducer, useState } from 'react';\nimport { NetworkContext } from './context';\nimport { defaultNetworkState, networksReducer } from './reducer';\nimport { Web3Provider, Provider } from '@ethersproject/providers';\nimport { subscribeToProviderEvents, getInjectedProvider } from '../../../helpers';\nimport { useConfig } from '../../config';\nimport { useLocalStorage } from '../../../hooks';\nimport detectEthereumProvider from '@metamask/detect-provider';\n\nfunction tryToGetAccount(_x) {\n  return _tryToGetAccount.apply(this, arguments);\n}\n/**\n * @internal Intended for internal use - use it on your own risk\n */\n\n\nfunction _tryToGetAccount() {\n  _tryToGetAccount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(provider) {\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            _context4.next = 3;\n            return provider.getSigner().getAddress();\n\n          case 3:\n            return _context4.abrupt(\"return\", _context4.sent);\n\n          case 6:\n            _context4.prev = 6;\n            _context4.t0 = _context4[\"catch\"](0);\n\n            if (!(_context4.t0.code === 'UNSUPPORTED_OPERATION')) {\n              _context4.next = 10;\n              break;\n            }\n\n            return _context4.abrupt(\"return\", undefined);\n\n          case 10:\n            throw _context4.t0;\n\n          case 11:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, null, [[0, 6]]);\n  }));\n  return _tryToGetAccount.apply(this, arguments);\n}\n\nexport function NetworkProvider(_ref) {\n  var children = _ref.children,\n      providerOverride = _ref.providerOverride;\n\n  var _useConfig = useConfig(),\n      autoConnect = _useConfig.autoConnect,\n      pollingInterval = _useConfig.pollingInterval;\n\n  var _useReducer = useReducer(networksReducer, defaultNetworkState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      network = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var _useState = useState(function () {\n    return function () {\n      return undefined;\n    };\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      onUnsubscribe = _useState2[0],\n      setOnUnsubscribe = _useState2[1];\n\n  var _useLocalStorage = useLocalStorage('shouldConnectMetamask'),\n      _useLocalStorage2 = _slicedToArray(_useLocalStorage, 2),\n      shouldConnectMetamask = _useLocalStorage2[0],\n      setShouldConnectMetamask = _useLocalStorage2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isLoading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var activateBrowserWallet = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var injectedProvider;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            setLoading(true);\n            _context.next = 3;\n            return getInjectedProvider(pollingInterval);\n\n          case 3:\n            injectedProvider = _context.sent;\n\n            if (injectedProvider) {\n              _context.next = 8;\n              break;\n            }\n\n            reportError(new Error('No injected provider available'));\n            setLoading(false);\n            return _context.abrupt(\"return\");\n\n          case 8:\n            _context.prev = 8;\n            _context.next = 11;\n            return injectedProvider.send('eth_requestAccounts', []);\n\n          case 11:\n            setShouldConnectMetamask(true);\n            _context.next = 19;\n            break;\n\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](8);\n            reportError(_context.t0);\n            setShouldConnectMetamask(false);\n            throw _context.t0;\n\n          case 19:\n            _context.prev = 19;\n            setLoading(false);\n            return _context.finish(19);\n\n          case 22:\n            return _context.abrupt(\"return\", activate(injectedProvider));\n\n          case 23:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[8, 14, 19, 22]]);\n  })), []);\n  useEffect(function () {\n    if (providerOverride) {\n      activate(providerOverride);\n    }\n  }, [providerOverride]);\n  var update = useCallback(function (newNetwork) {\n    dispatch({\n      type: 'UPDATE_NETWORK',\n      network: newNetwork\n    });\n  }, [network]);\n  var reportError = useCallback(function (error) {\n    console.error(error);\n    dispatch({\n      type: 'ADD_ERROR',\n      error: error\n    });\n  }, []);\n  var deactivate = useCallback(function () {\n    setShouldConnectMetamask(false);\n    update({\n      accounts: []\n    });\n  }, []);\n  var onDisconnect = useCallback(function (error) {\n    deactivate();\n    reportError(error);\n  }, []);\n  useEffect(function () {\n    setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _a, _b, _c;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n\n              if (!(shouldConnectMetamask && autoConnect && !providerOverride)) {\n                _context2.next = 8;\n                break;\n              }\n\n              _context2.next = 4;\n              return detectEthereumProvider();\n\n            case 4:\n              if (!(shouldConnectMetamask && ((_c = (_b = (_a = window.ethereum) === null || _a === void 0 ? void 0 : _a._state) === null || _b === void 0 ? void 0 : _b.accounts) === null || _c === void 0 ? void 0 : _c.length) === 0)) {\n                _context2.next = 6;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 6:\n              _context2.next = 8;\n              return activateBrowserWallet();\n\n            case 8:\n              _context2.next = 13;\n              break;\n\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.warn(_context2.t0);\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 10]]);\n    })));\n  }, [shouldConnectMetamask, autoConnect, providerOverride]);\n  var activate = useCallback( /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(provider) {\n      var _a, wrappedProvider, account, chainId, clearSubscriptions;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              wrappedProvider = Provider.isProvider(provider) ? provider : new Web3Provider(provider);\n              _context3.prev = 1;\n              setLoading(true);\n              _context3.next = 5;\n              return tryToGetAccount(wrappedProvider);\n\n            case 5:\n              account = _context3.sent;\n              _context3.next = 8;\n              return wrappedProvider.getNetwork();\n\n            case 8:\n              _context3.t1 = _a = _context3.sent;\n              _context3.t0 = _context3.t1 === null;\n\n              if (_context3.t0) {\n                _context3.next = 12;\n                break;\n              }\n\n              _context3.t0 = _a === void 0;\n\n            case 12:\n              if (!_context3.t0) {\n                _context3.next = 16;\n                break;\n              }\n\n              _context3.t2 = void 0;\n              _context3.next = 17;\n              break;\n\n            case 16:\n              _context3.t2 = _a.chainId;\n\n            case 17:\n              chainId = _context3.t2;\n              onUnsubscribe();\n              clearSubscriptions = subscribeToProviderEvents(wrappedProvider.provider, update, onDisconnect);\n              setOnUnsubscribe(function () {\n                return clearSubscriptions;\n              });\n              update({\n                provider: wrappedProvider,\n                chainId: chainId,\n                accounts: account ? [account] : []\n              });\n              _context3.next = 28;\n              break;\n\n            case 24:\n              _context3.prev = 24;\n              _context3.t3 = _context3[\"catch\"](1);\n              reportError(_context3.t3);\n              throw _context3.t3;\n\n            case 28:\n              _context3.prev = 28;\n              setLoading(false);\n              return _context3.finish(28);\n\n            case 31:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[1, 24, 28, 31]]);\n    }));\n\n    return function (_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }(), [onUnsubscribe]);\n  return _jsx(NetworkContext.Provider, {\n    value: {\n      network: network,\n      update: update,\n      activate: activate,\n      deactivate: deactivate,\n      reportError: reportError,\n      activateBrowserWallet: activateBrowserWallet,\n      isLoading: isLoading\n    },\n    children: children\n  });\n}","map":{"version":3,"mappings":"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","names":["useCallback","useEffect","useReducer","useState","NetworkContext","defaultNetworkState","networksReducer","Web3Provider","Provider","subscribeToProviderEvents","getInjectedProvider","useConfig","useLocalStorage","detectEthereumProvider","tryToGetAccount","provider","getSigner","getAddress","code","undefined","NetworkProvider","children","providerOverride","autoConnect","pollingInterval","network","dispatch","onUnsubscribe","setOnUnsubscribe","shouldConnectMetamask","setShouldConnectMetamask","isLoading","setLoading","activateBrowserWallet","injectedProvider","reportError","Error","send","activate","update","newNetwork","type","error","console","deactivate","accounts","onDisconnect","setTimeout","window","ethereum","_a","_state","_b","_c","length","warn","wrappedProvider","isProvider","account","getNetwork","chainId","clearSubscriptions","_jsx","value"],"sources":["../../../../../../src/providers/network/network/provider.tsx"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}